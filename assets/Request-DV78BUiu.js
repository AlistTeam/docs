import{a as S}from"./index-CmmzNXUp.js";import{a1 as A,a2 as B,a3 as I,d as R,r as n,b as g,o as f,e as s,f as r,k as L,g as _,u as a,h as i,F as $,t as P,N as k}from"./app-Dr385GFQ.js";import{N as E}from"./Checkbox-SCud3EZm.js";import{B as N}from"./Button-Dff9sXF-.js";import{N as q}from"./Input-B0IhrA8Q.js";import{N as b}from"./Alert-C2hF9rwd.js";import{N as M}from"./Image-DFAkB4zb.js";import{_ as O}from"./plugin-vue_export-helper-DlAUqK2U.js";function Q(){const y=A(B,null);return y===null&&I("use-message","No outer <n-message-provider /> founded. See prerequisite in https://www.naiveui.com/en-US/os-theme/components/message for more details. If you want to use `useMessage` outside setup, please check https://www.naiveui.com/zh-CN/os-theme/components/message#Q-&-A."),y}const z="https://alist.example.com/tool/aliyundrive/callback",T="76917ccccd4441c39457a04f6084fb2f",V=R({__name:"Request",setup(y){function U(){const t=new URL("https://open.aliyundrive.com/oauth/authorize");t.searchParams.set("client_id",u.value?c.value:T),t.searchParams.set("redirect_uri",z),t.searchParams.set("scope","user:base,file:all:read,file:all:write"),t.searchParams.set("response_type","code"),t.searchParams.set("state",window.btoa(u.value?`${c.value}::${m.value}`:"::")),t.searchParams.set("relogin","true"),window.open(t.toString(),"_blank")}const o=n(),w=n(!1),c=n(""),m=n(""),u=n(!1);async function x(){try{w.value=!0;const e=await(await fetch(S()+"/alist/ali_open/qr",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u.value?{client_id:c.value,client_secret:m.value}:{})})).json();o.value=e}catch(t){console.log(t),o.value={error:"error",qrCodeUrl:"",sid:""}}finally{w.value=!1}}const v=n(),h=n(!1),C=Q();async function j(){var t;try{h.value=!0;const l=await(await fetch(`${S()}/proxy/https://open.aliyundrive.com/oauth/qrcode/${(t=o.value)==null?void 0:t.sid}/status`)).json();if(v.value=l,l.status==="LoginSuccess"){const d=new URL(z);d.searchParams.set("code",l.authCode),window.open(d.toString(),"_blank")}else C.warning(l.status)}catch(e){console.log(e),C.error(String(e))}finally{h.value=!1}}return(t,e)=>(f(),g(a(k),{vertical:"",size:"large"},{default:s(()=>{var l,d;return[r(a(E),{checked:u.value,"onUpdate:checked":e[0]||(e[0]=p=>u.value=p),size:"large"},{default:s(()=>e[3]||(e[3]=[i("使用自己的客户端信息")])),_:1,__:[3]},8,["checked"]),u.value?(f(),L($,{key:0},[r(a(q),{size:"large",value:c.value,"onUpdate:value":e[1]||(e[1]=p=>c.value=p),placeholder:"client_id"},null,8,["value"]),r(a(q),{size:"large",value:m.value,"onUpdate:value":e[2]||(e[2]=p=>m.value=p),placeholder:"client_secret"},null,8,["value"])],64)):_("",!0),r(a(N),{size:"large",type:"primary",onClick:U,block:""},{default:s(()=>e[4]||(e[4]=[i("前往登录")])),_:1,__:[4]}),r(a(N),{size:"large",type:"info",onClick:x,block:"",loading:w.value,disabled:!!o.value},{default:s(()=>e[5]||(e[5]=[i("扫描二维码 ")])),_:1,__:[5]},8,["loading","disabled"]),(l=o.value)!=null&&l.error?(f(),g(a(b),{key:1,title:"Error",type:"error"},{default:s(()=>[i(P(o.value.error),1)]),_:1})):_("",!0),(d=o.value)!=null&&d.qrCodeUrl?(f(),g(a(k),{key:2,vertical:""},{default:s(()=>[r(a(k),{justify:"center"},{default:s(()=>[r(a(M),{width:"300",src:o.value.qrCodeUrl},null,8,["src"])]),_:1}),r(a(b),{title:"扫描二维码",type:"info"},{default:s(()=>e[6]||(e[6]=[i("使用 AliyunDrive APP 扫描，然后点击下方按钮")])),_:1,__:[6]}),r(a(N),{size:"large",onClick:j,type:"info",block:"",loading:h.value},{default:s(()=>e[7]||(e[7]=[i("已扫码")])),_:1,__:[7]},8,["loading"])]),_:1})):_("",!0),v.value&&v.value.status!=="LoginSuccess"?(f(),g(a(b),{key:3,title:"Warning",type:"warning"},{default:s(()=>[i(P(v.value.status),1)]),_:1})):_("",!0)]}),_:1}))}}),Y=O(V,[["__scopeId","data-v-545b82dc"]]);export{Y as R};
